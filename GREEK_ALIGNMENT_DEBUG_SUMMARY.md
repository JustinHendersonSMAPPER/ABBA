# Greek Alignment Coverage Debug Summary

## Issue Identified
The Greek alignment coverage was showing 0% for all translations because of a filename mismatch between:
- **Expected filenames**: Book codes like `Matt.json`, `Mark.json`, `Rom.json`
- **Actual filenames**: Lowercase full names like `matthew.json`, `mark.json`, `romans.json`

## Root Cause
In `src/abba_coverage_analyzer.py` line 137:
```python
morph_path = self.morphology_dir / language / f"{book_code}.json"
```

This code constructs the morphology file path using the book code directly (e.g., "Matt"), but the Greek morphology files use lowercase full book names (e.g., "matthew").

## Solution Applied
Created copies of all Greek morphology files with book code names:

### Mapping Used
```python
BOOK_CODE_TO_GREEK_FILE = {
    'Matt': 'matthew',
    'Mark': 'mark', 
    'Luke': 'luke',
    'John': 'john',
    'Acts': 'acts',
    'Rom': 'romans',
    '1Cor': '1corinthians',
    '2Cor': '2corinthians',
    'Gal': 'galatians',
    'Eph': 'ephesians',
    'Phil': 'philippians',
    'Col': 'colossians',
    '1Thess': '1thessalonians',
    '2Thess': '2thessalonians',
    '1Tim': '1timothy',
    '2Tim': '2timothy',
    'Titus': 'titus',
    'Phlm': 'philemon',
    'Heb': 'hebrews',
    'Jas': 'james',
    '1Pet': '1peter',
    '2Pet': '2peter',
    '1John': '1john',
    '2John': '2john',
    '3John': '3john',
    'Jude': 'jude',
    'Rev': 'revelation'
}
```

### Files Created
- **fix_greek_morphology_mapping.py**: Script that copies Greek morphology files with book code names
- **debug_greek_alignment.py**: Diagnostic script to check the mapping and file availability
- **patch_coverage_analyzer.py**: Script to patch the coverage analyzer with proper mapping logic
- **check_exports_coverage.py**: Script to check for export directories and analyze coverage

## Current Status
1. ✅ Greek morphology files now exist with both naming conventions:
   - Original: `matthew.json`, `mark.json`, etc.
   - Copies: `Matt.json`, `Mark.json`, etc.

2. ✅ The morphology data is properly formatted with:
   - Verse IDs using lowercase names (e.g., "matthew.1.1")
   - Complete word-level morphological analysis
   - Parse codes and morphological features

3. ⚠️ No actual Bible export directories found with processed data
   - The coverage analyzer expects directories like `full_enhanced_export`
   - These need to be generated by running the export process

## Next Steps
To fully resolve the Greek alignment coverage issue:

1. **Run the export process** to generate Bible data with Greek alignment
2. **Verify the export includes Greek morphology** by checking for `greek_text` or `greek_words` fields
3. **Re-run the coverage analyzer** to confirm Greek coverage is now properly calculated

## Alternative Long-term Fix
Instead of duplicating files, the coverage analyzer should be updated to use the mapping dictionary:

```python
def get_morphology_filename(book_code, language):
    if language == 'greek' and book_code in BOOK_CODE_TO_GREEK_FILE:
        return BOOK_CODE_TO_GREEK_FILE[book_code] + '.json'
    return book_code + '.json'
```

This would eliminate the need for duplicate files and handle the naming mismatch properly.